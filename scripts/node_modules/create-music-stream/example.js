const Speaker = require('speaker')
const createMusicStream = require('.')

// createMusicStream(process.argv[2])

//   .pipe(new Speaker())


createMusicStream(musicSource)
  .pipe(musicBeatDetector.getAnalyzer())
  .on('peak-detected', (pos, bpm) => console.log(`peak-detected at ${pos}ms, detected bpm ${bpm}`))
  .on('end', () => {
    fs.writeFileSync('graph.svg', musicGraph.getSVG())
    console.log('end')
  })

  .pipe(new Speaker())
  .on('open', () => musicBeatScheduler.start())

createMusicStream('./track.mp3', console.log)
  .pipe(new Speaker())